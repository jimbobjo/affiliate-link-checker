<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Affiliate Link Health Checker - Professional Validation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #1e40af;
            --surface-light: #f1f5f9;
            --surface-medium: #cbd5e1;
            --text-primary: #0f172a;
            --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 4px 6px rgba(0, 0, 0, 0.07);
            --border-radius: 2px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--surface-light);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            overflow: hidden;
        }

        .header {
            background: var(--primary-blue);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
        }

        .header::after {
            content: "Professional Link Validation";
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            padding: 6px 12px;
            border-radius: var(--border-radius);
            font-size: 12px;
            font-weight: 600;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            margin-bottom: 20px;
        }

        .hero-character {
            display: inline-block;
            margin: 10px 0;
        }

        .main-content {
            padding: 40px 30px;
        }

        .auth-status {
            background: var(--surface-light);
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            border: 1px solid var(--surface-medium);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .auth-info {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .auth-actions {
            display: flex;
            gap: 10px;
        }

        .input-section {
            background: var(--surface-light);
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            border: 1px solid var(--surface-medium);
            transition: all 0.3s ease;
        }

        .input-section:hover {
            border-color: var(--primary-blue);
            background: #f0f4ff;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 1px solid var(--surface-medium);
            border-radius: var(--border-radius);
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
            background: white;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea:disabled {
            background: var(--surface-light);
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            box-shadow: var(--shadow-subtle);
            position: relative;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #1e3a8a;
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }

        .btn-secondary {
            background: var(--text-primary);
            color: white;
        }

        .btn-demo {
            background: var(--primary-blue);
            color: white;
        }

        .btn-advanced {
            background: var(--surface-medium);
            color: var(--text-primary);
        }

        .btn-auth {
            background: var(--primary-blue);
            color: white;
            font-size: 14px;
            padding: 8px 16px;
        }

        .advanced-options {
            background: var(--surface-light);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
            border: 1px solid var(--surface-medium);
        }

        .advanced-options.active {
            display: block;
        }

        .option-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-blue);
        }

        .option-item input[type="number"] {
            width: 80px;
            padding: 6px;
            border: 1px solid var(--surface-medium);
            border-radius: var(--border-radius);
        }

        .option-item select {
            padding: 6px 10px;
            border: 1px solid var(--surface-medium);
            border-radius: var(--border-radius);
            background: white;
        }

        .progress-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid var(--surface-medium);
            display: none;
        }

        .progress-section.active {
            display: block;
        }

        .progress-bar-container {
            background: var(--surface-medium);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: var(--primary-blue);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-details {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .results-section {
            margin-top: 30px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-header h3 {
            color: var(--text-primary);
            font-size: 1.5em;
        }

        .stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            min-width: 80px;
            box-shadow: var(--shadow-subtle);
        }

        .stat-healthy {
            background: var(--surface-light);
            color: var(--text-primary);
            border: 1px solid var(--surface-medium);
        }

        .stat-broken {
            background: var(--text-primary);
            color: white;
        }

        .stat-warning {
            background: var(--surface-medium);
            color: var(--text-primary);
        }

        .stat-redirect {
            background: var(--primary-blue);
            color: white;
        }

        .result-item {
            background: white;
            border: 1px solid var(--surface-medium);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .result-item:hover {
            box-shadow: var(--shadow-medium);
            transform: translateY(-2px);
        }

        .result-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
        }

        .result-item.healthy::before {
            background: var(--primary-blue);
        }

        .result-item.broken::before {
            background: var(--text-primary);
        }

        .result-item.warning::before {
            background: var(--surface-medium);
        }

        .result-item.redirect::before {
            background: var(--primary-blue);
        }

        .result-url {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            color: var(--primary-blue);
            margin-bottom: 10px;
            word-break: break-all;
        }

        .result-details {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
        }

        .result-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-healthy {
            background: var(--primary-blue);
            color: white;
        }

        .status-broken {
            background: var(--text-primary);
            color: white;
        }

        .status-warning {
            background: var(--surface-medium);
            color: var(--text-primary);
        }

        .status-redirect {
            background: var(--primary-blue);
            color: white;
        }

        .result-metrics {
            text-align: right;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .redirect-chain {
            background: var(--surface-light);
            padding: 10px;
            border-radius: var(--border-radius);
            margin-top: 10px;
            font-size: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .redirect-chain .redirect-step {
            margin-bottom: 5px;
            padding-left: 15px;
            position: relative;
        }

        .redirect-step::before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--primary-blue);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--primary-blue);
        }

        .spinner {
            border: 4px solid var(--surface-medium);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .export-section {
            background: var(--surface-light);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            border: 1px solid var(--surface-medium);
        }

        .filters-section {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid var(--surface-medium);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-item select {
            padding: 5px 10px;
            border: 1px solid var(--surface-medium);
            border-radius: var(--border-radius);
        }

        .email-capture-section {
            background: var(--primary-blue);
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin: 30px 0;
            text-align: center;
            position: relative;
        }

        .capture-header {
            margin-bottom: 25px;
        }

        .capture-header h3 {
            font-size: 1.8em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .capture-header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .email-form {
            margin-bottom: 25px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            max-width: 500px;
            margin: 0 auto;
            flex-wrap: wrap;
        }

        .email-input {
            flex: 2;
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            min-width: 250px;
        }

        .email-input:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .btn-capture {
            flex: 1;
            background: var(--text-primary);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
            box-shadow: var(--shadow-medium);
        }

        .btn-capture:hover {
            background: #020617;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(15, 23, 42, 0.4);
        }

        .capture-benefits {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .benefit-icon {
            font-size: 16px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .modal h3 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .modal p {
            margin-bottom: 20px;
            color: var(--text-secondary);
        }

        .modal-form {
            margin-bottom: 20px;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--surface-medium);
            border-radius: var(--border-radius);
            font-size: 16px;
        }

        .error-message {
            background: #fecaca;
            color: #991b1b;
            padding: 10px;
            border-radius: var(--border-radius);
            margin-top: 10px;
            font-size: 14px;
        }

        .success-message {
            background: #dcfce7;
            color: #166534;
            padding: 10px;
            border-radius: var(--border-radius);
            margin-top: 10px;
            font-size: 14px;
        }

        .verification-notice {
            background: #dbeafe;
            color: #1e40af;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        .footer {
            background: var(--surface-light);
            padding: 20px 30px;
            border-top: 1px solid var(--surface-medium);
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .footer-links {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--primary-blue);
            text-decoration: none;
            margin: 0 15px;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
            }
            
            .results-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats {
                justify-content: center;
            }
            
            .result-details {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .result-metrics {
                text-align: left;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .email-input, .btn-capture {
                min-width: 100%;
            }
            
            .capture-benefits {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔗 Affiliate Link Health Checker</h1>
            <p>Professional link validation for affiliate marketers - ensure maximum performance and revenue</p>
            <div class="hero-character">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="30" r="12" fill="currentColor"/>
                    <rect x="42" y="42" width="16" height="20" rx="2" fill="currentColor"/>
                    <rect x="35" y="50" width="8" height="3" rx="1" fill="currentColor"/>
                    <rect x="57" y="50" width="8" height="3" rx="1" fill="currentColor"/>
                    <rect x="46" y="62" width="8" height="15" rx="2" fill="currentColor"/>
                    <rect x="40" y="75" width="6" height="8" rx="1" fill="currentColor"/>
                    <rect x="54" y="75" width="6" height="8" rx="1" fill="currentColor"/>
                    <rect x="52" y="45" width="6" height="6" rx="3" fill="rgba(255,255,255,0.7)"/>
                </svg>
            </div>
        </div>

        <div class="main-content">
            <div class="auth-status" id="authStatus">
                <div class="auth-info">
                    <span id="authMessage">🚀 Test with sample links below or register for personalized analysis</span>
                </div>
                <div class="auth-actions">
                    <button class="btn btn-auth" onclick="showAuthModal('login')" id="loginBtn">Login</button>
                    <button class="btn btn-auth" onclick="showAuthModal('register')" id="registerBtn">Register</button>
                    <button class="btn btn-auth hidden" onclick="logout()" id="logoutBtn">Logout</button>
                </div>
            </div>

            <div class="input-section">
                <div class="input-group">
                    <label for="links">Professional Link Validation Engine:</label>
                    <textarea id="links" placeholder="🎯 Ready to test? Click 'Load Sample Links' below to try our validation engine with pre-configured examples.

💡 Want to analyze your own affiliate URLs? 
   Register free to unlock custom link analysis with secure result storage." disabled></textarea>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="checkLinks()" id="checkLinksBtn" disabled>🚀 Analyze Links (Register Free)</button>
                    <button class="btn btn-demo" onclick="loadDemoLinks()">📝 Load Sample Links</button>
                    <button class="btn btn-advanced" onclick="toggleAdvancedOptions()">⚙️ Advanced Options</button>
                    <button class="btn btn-secondary btn-small" onclick="clearAll()">🗑️ Clear</button>
                </div>

                <div id="advancedOptions" class="advanced-options">
                    <h4>Advanced Testing Options</h4>
                    <div class="option-group">
                        <div class="option-item">
                            <input type="checkbox" id="followRedirects" checked>
                            <label for="followRedirects">Follow Redirects</label>
                        </div>
                        <div class="option-item">
                            <input type="checkbox" id="checkSSL" checked>
                            <label for="checkSSL">Verify SSL Certificates</label>
                        </div>
                        <div class="option-item">
                            <input type="checkbox" id="checkSpeed">
                            <label for="checkSpeed">Performance Analysis</label>
                        </div>
                    </div>
                    <div class="option-group">
                        <div class="option-item">
                            <label for="timeout">Timeout (seconds):</label>
                            <input type="number" id="timeout" value="10" min="5" max="30">
                        </div>
                        <div class="option-item">
                            <label for="userAgent">User Agent:</label>
                            <select id="userAgent">
                                <option value="default">Default</option>
                                <option value="chrome">Chrome Desktop</option>
                                <option value="mobile">Mobile Safari</option>
                                <option value="bot">Googlebot</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="progressSection" class="progress-section">
                <div class="progress-bar-container">
                    <div id="progressBar" class="progress-bar"></div>
                </div>
                <div class="progress-details">
                    <span id="progressText">Processing links...</span>
                    <span id="progressCount">0 / 0</span>
                </div>
            </div>

            <div id="results" class="results-section hidden">
                <div class="results-header">
                    <h3>📊 Link Health Report</h3>
                    <div class="stats">
                        <div class="stat stat-healthy">
                            <div id="healthyCount">0</div>
                            <small>Healthy</small>
                        </div>
                        <div class="stat stat-broken">
                            <div id="brokenCount">0</div>
                            <small>Broken</small>
                        </div>
                        <div class="stat stat-warning">
                            <div id="warningCount">0</div>
                            <small>Slow</small>
                        </div>
                        <div class="stat stat-redirect">
                            <div id="redirectCount">0</div>
                            <small>Redirects</small>
                        </div>
                    </div>
                </div>

                <div class="filters-section">
                    <div class="filter-item">
                        <label for="statusFilter">Filter by status:</label>
                        <select id="statusFilter" onchange="filterResults()">
                            <option value="all">All Links</option>
                            <option value="healthy">Healthy Only</option>
                            <option value="broken">Broken Only</option>
                            <option value="warning">Slow Only</option>
                            <option value="redirect">Redirects Only</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="sortBy">Sort by:</label>
                        <select id="sortBy" onchange="sortResults()">
                            <option value="original">Original Order</option>
                            <option value="status">Status</option>
                            <option value="responseTime">Response Time</option>
                            <option value="url">URL</option>
                        </select>
                    </div>
                </div>
                
                <div id="resultsList"></div>

                <div class="export-section">
                    <button class="btn btn-primary" onclick="exportResults()">📤 Export Report (CSV)</button>
                    <button class="btn btn-secondary" onclick="exportJSON()">📋 Export JSON</button>
                    <p style="margin-top: 10px; color: #6c757d; font-size: 14px;">
                        Save this report to track link performance over time
                    </p>
                </div>
            </div>

            <div class="email-capture-section">
                <div class="capture-header">
                    <h3>🚀 Get Early Access to Pro Marketing Tools</h3>
                    <p>Join <strong>500+ affiliate marketers</strong> waiting for our complete suite of 25+ marketing automation tools launching soon.</p>
                </div>
                
                <form name="pro-waitlist" method="POST" data-netlify="true" class="email-form" onsubmit="handleEmailSubmit(event)">
                    <div class="form-row">
                        <input type="email" name="email" placeholder="Enter your email address" required class="email-input">
                        <button type="submit" class="btn btn-capture">Join Waitlist</button>
                    </div>
                    <input type="hidden" name="form-name" value="pro-waitlist">
                    <input type="hidden" name="tool-source" value="affiliate-link-checker">
                    <input type="hidden" name="signup-date" id="signupDate">
                    <input type="hidden" name="verification-required" value="true">
                </form>
                
                <div class="capture-benefits">
                    <div class="benefit-item">
                        <span class="benefit-icon">🎯</span>
                        <span>First access when tools launch</span>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">💰</span>
                        <span>50% OFF early bird pricing</span>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">📧</span>
                        <span>Weekly affiliate tips</span>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">🔒</span>
                        <span>Double opt-in verification</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="footer-links">
                <a href="#" onclick="showLegalModal('terms')">Terms of Service</a>
                <a href="#" onclick="showLegalModal('privacy')">Privacy Policy</a>
                <a href="#" onclick="showLegalModal('disclaimer')">Disclaimer</a>
            </div>
            <p>&copy; 2025 AllAroundWorkers. All rights reserved. Professional affiliate link validation service.</p>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal">
            <h3 id="authModalTitle">Login</h3>
            <p id="authModalDescription">Access your account to analyze custom affiliate links and view history.</p>
            
            <div class="modal-form">
                <input type="email" id="authEmail" placeholder="Email address" class="modal-input" required>
                <input type="password" id="authPassword" placeholder="Password" class="modal-input" required>
                <div id="authConfirmGroup" class="hidden">
                    <input type="password" id="authConfirmPassword" placeholder="Confirm password" class="modal-input">
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="submitAuth()" id="authSubmitBtn">Login</button>
                    <button class="btn btn-secondary" onclick="closeAuthModal()">Cancel</button>
                </div>
                
                <p style="margin-top: 15px;">
                    <span id="authSwitchText">Don't have an account?</span>
                    <a href="#" onclick="switchAuthMode()" id="authSwitchLink">Register here</a>
                </p>
            </div>
            
            <div id="authMessages"></div>
        </div>
    </div>

    <!-- Legal Modal -->
    <div class="modal-overlay" id="legalModal">
        <div class="modal" style="max-width: 600px;">
            <h3 id="legalModalTitle">Terms of Service</h3>
            <div id="legalModalContent" style="max-height: 400px; overflow-y: auto; text-align: left; padding: 20px; background: #f8fafc; border-radius: 8px; margin: 20px 0;">
                <!-- Legal content will be populated here -->
            </div>
            <button class="btn btn-primary" onclick="closeLegalModal()">Close</button>
        </div>
    </div>

    <script>
        let checkResults = [];
        let originalResults = [];
        let isChecking = false;
        let isAuthenticated = false;
        let currentUser = null;
        let authMode = 'login';

        // Demo links for testing
        const demoLinks = `https://httpbin.org/status/200
https://httpbin.org/status/404
https://httpbin.org/redirect/3
https://google.com
https://httpbin.org/status/500
https://github.com
https://httpbin.org/delay/3`;

        // Initialize application
        window.addEventListener('load', function() {
            checkAuthState();
            addTooltips();
        });

        // Authentication Management
        function checkAuthState() {
            const stored = localStorage.getItem('userAuth');
            if (stored) {
                try {
                    const auth = JSON.parse(stored);
                    if (auth.verified && Date.now() - auth.timestamp < 86400000) { // 24 hour session
                        setAuthenticatedState(auth.user);
                    } else {
                        localStorage.removeItem('userAuth');
                    }
                } catch {
                    localStorage.removeItem('userAuth');
                }
            }
        }

        function setAuthenticatedState(user) {
            isAuthenticated = true;
            currentUser = user;
            
            document.getElementById('authMessage').textContent = `Welcome back, ${user.email}! Custom link analysis enabled.`;
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('registerBtn').classList.add('hidden');
            document.getElementById('logoutBtn').classList.remove('hidden');
            
            const textarea = document.getElementById('links');
            textarea.disabled = false;
            textarea.placeholder = `https://amazon.com/dp/B123456789?tag=youraffid
https://commission-junction.com/tracking/12345
https://shareasale.com/r.cfm?b=123&u=456&m=789

✅ Custom link analysis enabled - Enter your affiliate URLs for secure validation and result history.`;
            
            const checkBtn = document.getElementById('checkLinksBtn');
            checkBtn.disabled = false;
            checkBtn.textContent = '🚀 Analyze Links';
        }

        function logout() {
            isAuthenticated = false;
            currentUser = null;
            localStorage.removeItem('userAuth');
            
            document.getElementById('authMessage').textContent = `🚀 Test with sample links below or register for personalized analysis`;
            document.getElementById('loginBtn').classList.remove('hidden');
            document.getElementById('registerBtn').classList.remove('hidden');
            document.getElementById('logoutBtn').classList.add('hidden');
            
            const textarea = document.getElementById('links');
            textarea.disabled = true;
            textarea.value = '';
            textarea.placeholder = `🎯 Ready to test? Click "Load Sample Links" below to try our validation engine with pre-configured examples.

💡 Want to analyze your own affiliate URLs? 
   Register free to unlock custom link analysis with secure result storage.`;
            
            const checkBtn = document.getElementById('checkLinksBtn');
            checkBtn.disabled = true;
            checkBtn.textContent = '🚀 Analyze Links (Register Free)';
            
            clearResults();
        }

        function showAuthModal(mode) {
            authMode = mode;
            const modal = document.getElementById('authModal');
            const title = document.getElementById('authModalTitle');
            const description = document.getElementById('authModalDescription');
            const submitBtn = document.getElementById('authSubmitBtn');
            const switchText = document.getElementById('authSwitchText');
            const switchLink = document.getElementById('authSwitchLink');
            const confirmGroup = document.getElementById('authConfirmGroup');
            
            if (mode === 'register') {
                title.textContent = 'Create Account';
                description.textContent = 'Register for free to analyze custom affiliate links and access result history.';
                submitBtn.textContent = 'Create Account';
                switchText.textContent = 'Already have an account?';
                switchLink.textContent = 'Login here';
                confirmGroup.classList.remove('hidden');
            } else {
                title.textContent = 'Login';
                description.textContent = 'Access your account to analyze custom affiliate links and view history.';
                submitBtn.textContent = 'Login';
                switchText.textContent = "Don't have an account?";
                switchLink.textContent = 'Register here';
                confirmGroup.classList.add('hidden');
            }
            
            modal.classList.add('active');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('authEmail').value = '';
            document.getElementById('authPassword').value = '';
            document.getElementById('authConfirmPassword').value = '';
            document.getElementById('authMessages').innerHTML = '';
        }

        function switchAuthMode() {
            authMode = authMode === 'login' ? 'register' : 'login';
            showAuthModal(authMode);
        }

        function submitAuth() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const confirmPassword = document.getElementById('authConfirmPassword').value;
            const messagesDiv = document.getElementById('authMessages');
            
            messagesDiv.innerHTML = '';
            
            if (!email || !password) {
                showAuthMessage('Please fill in all fields.', 'error');
                return;
            }
            
            if (authMode === 'register') {
                if (password !== confirmPassword) {
                    showAuthMessage('Passwords do not match.', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    showAuthMessage('Password must be at least 6 characters long.', 'error');
                    return;
                }
                
                // Simulate registration
                const user = { email, verified: false };
                showAuthMessage('Account created! Please check your email to verify your account before logging in.', 'verification');
                
                // In production, this would trigger actual email verification
                setTimeout(() => {
                    user.verified = true;
                    localStorage.setItem('userAuth', JSON.stringify({
                        user,
                        verified: true,
                        timestamp: Date.now()
                    }));
                    closeAuthModal();
                    setAuthenticatedState(user);
                    showMessage('Account verified! You can now analyze custom affiliate links.', 'success');
                }, 2000);
                
            } else {
                // Simulate login
                const user = { email, verified: true };
                localStorage.setItem('userAuth', JSON.stringify({
                    user,
                    verified: true,
                    timestamp: Date.now()
                }));
                closeAuthModal();
                setAuthenticatedState(user);
                showMessage('Login successful! Custom link analysis is now available.', 'success');
            }
        }

        function showAuthMessage(message, type) {
            const messagesDiv = document.getElementById('authMessages');
            messagesDiv.innerHTML = `<div class="${type === 'error' ? 'error-message' : type === 'verification' ? 'verification-notice' : 'success-message'}">${message}</div>`;
        }

        // Core Application Functions
        function loadDemoLinks() {
            document.getElementById('links').value = demoLinks;
            
            if (!isAuthenticated) {
                const textarea = document.getElementById('links');
                textarea.disabled = false;
                const checkBtn = document.getElementById('checkLinksBtn');
                checkBtn.disabled = false;
                checkBtn.textContent = '🚀 Check Demo Links';
            }
        }

        function toggleAdvancedOptions() {
            const options = document.getElementById('advancedOptions');
            options.classList.toggle('active');
        }

        function clearAll() {
            document.getElementById('links').value = '';
            clearResults();
            
            if (!isAuthenticated) {
                const textarea = document.getElementById('links');
                textarea.disabled = true;
                const checkBtn = document.getElementById('checkLinksBtn');
                checkBtn.disabled = true;
                checkBtn.textContent = '🚀 Check Links (Login Required)';
            }
        }

        function clearResults() {
            document.getElementById('results').classList.add('hidden');
            document.getElementById('progressSection').classList.remove('active');
            checkResults = [];
            originalResults = [];
        }

        async function checkLinks() {
            if (isChecking) return;

            const linksText = document.getElementById('links').value.trim();
            if (!linksText) {
                showMessage('Please enter some links to check!', 'error');
                return;
            }

            const links = linksText.split('\n').filter(link => link.trim());
            if (links.length === 0) {
                showMessage('Please enter valid links!', 'error');
                return;
            }

            const isDemoMode = linksText === demoLinks;
            
            if (!isAuthenticated && !isDemoMode) {
                showMessage('Please login or register to analyze custom links. Use "Try Demo Links" for testing.', 'error');
                showAuthModal('register');
                return;
            }

            if (links.length > 50) {
                showMessage('Maximum 50 links per request. Upgrade to Pro for unlimited checking!', 'error');
                return;
            }

            isChecking = true;
            checkResults = [];
            originalResults = [];

            document.getElementById('progressSection').classList.add('active');
            document.getElementById('results').classList.add('hidden');

            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressCount = document.getElementById('progressCount');

            progressCount.textContent = `0 / ${links.length}`;
            progressBar.style.width = '0%';
            progressText.textContent = 'Initializing enterprise-grade validation protocols...';

            const options = {
                followRedirects: document.getElementById('followRedirects').checked,
                checkSSL: document.getElementById('checkSSL').checked,
                checkSpeed: document.getElementById('checkSpeed').checked,
                timeout: parseInt(document.getElementById('timeout').value) * 1000,
                userAgent: document.getElementById('userAgent').value
            };

            try {
                progressText.textContent = 'Establishing secure API communication channels...';
                progressBar.style.width = '10%';

                const response = await fetch('/.netlify/functions/check-links', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        links: links,
                        options: options
                    })
                });

                progressText.textContent = 'Processing serverless function response...';
                progressBar.style.width = '70%';

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                if (!data.results || !Array.isArray(data.results)) {
                    throw new Error('Invalid API response structure received');
                }

                checkResults = data.results;
                originalResults = [...checkResults];

                progressText.textContent = 'Optimizing result presentation interface...';
                progressBar.style.width = '95%';

                setTimeout(() => {
                    progressBar.style.width = '100%';
                    progressCount.textContent = `${links.length} / ${links.length}`;
                    progressText.textContent = 'Enterprise validation protocols completed successfully!';

                    setTimeout(() => {
                        document.getElementById('progressSection').classList.remove('active');
                        document.getElementById('results').classList.remove('hidden');
                        updateStats();
                        displayResults();
                        
                        const processingTime = data.summary?.averageResponseTime || 'Unknown';
                        showMessage(`Successfully validated ${links.length} affiliate links. Average response time: ${processingTime}ms`, 'success');
                        
                        trackEvent('link_validation_completed', {
                            linkCount: links.length,
                            averageResponseTime: processingTime,
                            healthyLinks: data.summary?.healthy || 0,
                            brokenLinks: data.summary?.broken || 0,
                            authenticated: isAuthenticated
                        });
                        
                    }, 800);
                }, 300);

            } catch (error) {
                console.error('Enterprise validation pipeline encountered critical error:', error);
                
                let userMessage = 'Validation processing encountered an unexpected error.';
                let technicalContext = '';
                
                if (error.message.includes('fetch')) {
                    userMessage = 'Network connectivity issue detected. Please verify internet connection.';
                    technicalContext = 'Network layer communication failure';
                } else if (error.message.includes('HTTP 4')) {
                    userMessage = 'Request validation failed. Please verify link format and try again.';
                    technicalContext = 'Client request validation error';
                } else if (error.message.includes('HTTP 5')) {
                    userMessage = 'Server processing temporarily unavailable. Please retry in a few moments.';
                    technicalContext = 'Server-side processing error';
                } else if (error.message.includes('timeout')) {
                    userMessage = 'Request processing exceeded timeout limits. Consider reducing link count.';
                    technicalContext = 'Processing timeout exceeded';
                }
                
                document.getElementById('progressSection').classList.remove('active');
                showMessage(`${userMessage} (${error.message})`, 'error');
                
                trackEvent('link_validation_error', {
                    errorType: technicalContext,
                    errorMessage: error.message,
                    linkCount: links.length,
                    timestamp: new Date().toISOString()
                });
                
            } finally {
                isChecking = false;
            }
        }

        function updateStats() {
            const stats = {
                healthy: 0,
                broken: 0,
                warning: 0,
                redirect: 0
            };

            checkResults.forEach(result => {
                if (result.redirectChain && result.redirectChain.length > 0) {
                    stats.redirect++;
                } else {
                    stats[result.status]++;
                }
            });

            document.getElementById('healthyCount').textContent = stats.healthy;
            document.getElementById('brokenCount').textContent = stats.broken;
            document.getElementById('warningCount').textContent = stats.warning;
            document.getElementById('redirectCount').textContent = stats.redirect;
        }

        function displayResults() {
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';

            checkResults.forEach((result, index) => {
                const item = document.createElement('div');
                
                let statusClass = result.status;
                if (result.redirectChain && result.redirectChain.length > 0) {
                    statusClass = 'redirect';
                }
                
                item.className = `result-item ${statusClass}`;
                
                let redirectHtml = '';
                if (result.redirectChain && result.redirectChain.length > 0) {
                    redirectHtml = `
                        <div class="redirect-chain">
                            <strong>Redirect Chain Analysis:</strong>
                            ${result.redirectChain.map(step => 
                                `<div class="redirect-step">${step.url} → ${step.location} (HTTP ${step.status})</div>`
                            ).join('')}
                        </div>
                    `;
                }

                let errorHtml = '';
                if (result.error) {
                    errorHtml = `<div class="error-message">Technical Details: ${result.error}</div>`;
                }

                let headerInfo = '';
                if (result.headers) {
                    const serverInfo = result.headers.server ? `Server: ${result.headers.server}` : '';
                    const contentType = result.headers['content-type'] ? `Type: ${result.headers['content-type']}` : '';
                    headerInfo = `<small>${[serverInfo, contentType].filter(Boolean).join(' | ')}</small>`;
                }

                let performanceIndicator = '';
                if (result.responseTime) {
                    if (result.responseTime < 1000) {
                        performanceIndicator = '🚀 Excellent';
                    } else if (result.responseTime < 3000) {
                        performanceIndicator = '✅ Good';
                    } else if (result.responseTime < 5000) {
                        performanceIndicator = '⚠️ Slow';
                    } else {
                        performanceIndicator = '🐌 Very Slow';
                    }
                }
                
                item.innerHTML = `
                    <div class="result-url">${result.url}</div>
                    <div class="result-details">
                        <div class="result-info">
                            <span class="status-badge status-${statusClass}">
                                ${result.statusCode} ${result.message}
                            </span>
                            ${result.sslValid !== null ? `<small>SSL: ${result.sslValid ? '✅ Valid Certificate' : '❌ Certificate Issue'}</small>` : ''}
                            ${headerInfo}
                        </div>
                        <div class="result-metrics">
                            <div>${result.responseTime}ms ${performanceIndicator}</div>
                            <small>${new Date(result.timestamp).toLocaleTimeString()}</small>
                        </div>
                    </div>
                    ${redirectHtml}
                    ${errorHtml}
                `;
                
                resultsList.appendChild(item);
            });
        }

        function filterResults() {
            const filter = document.getElementById('statusFilter').value;
            
            if (filter === 'all') {
                checkResults = [...originalResults];
            } else {
                checkResults = originalResults.filter(result => {
                    if (filter === 'redirect') {
                        return result.redirectChain && result.redirectChain.length > 0;
                    }
                    return result.status === filter;
                });
            }
            
            displayResults();
            updateStats();
        }

        function sortResults() {
            const sortBy = document.getElementById('sortBy').value;
            
            switch (sortBy) {
                case 'status':
                    checkResults.sort((a, b) => a.status.localeCompare(b.status));
                    break;
                case 'responseTime':
                    checkResults.sort((a, b) => a.responseTime - b.responseTime);
                    break;
                case 'url':
                    checkResults.sort((a, b) => a.url.localeCompare(b.url));
                    break;
                case 'original':
                default:
                    checkResults = [...originalResults];
                    break;
            }
            
            displayResults();
        }

        function exportResults() {
            if (checkResults.length === 0) {
                showMessage('No results to export!', 'error');
                return;
            }

            const headers = ['URL', 'Status', 'Status Code', 'Message', 'Response Time (ms)', 'SSL Valid', 'Has Redirects', 'Checked At'];
            const rows = checkResults.map(result => [
                result.url,
                result.status,
                result.statusCode,
                result.message,
                result.responseTime,
                result.sslValid !== null ? (result.sslValid ? 'Yes' : 'No') : 'N/A',
                result.redirectChain && result.redirectChain.length > 0 ? 'Yes' : 'No',
                result.timestamp
            ]);

            let csvContent = headers.join(',') + '\n';
            rows.forEach(row => {
                csvContent += row.map(field => `"${field}"`).join(',') + '\n';
            });

            downloadFile(csvContent, `affiliate-links-health-report-${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
            showMessage('CSV report exported successfully!', 'success');
        }

        function exportJSON() {
            if (checkResults.length === 0) {
                showMessage('No results to export!', 'error');
                return;
            }

            const jsonContent = JSON.stringify({
                exportDate: new Date().toISOString(),
                totalLinks: checkResults.length,
                user: isAuthenticated ? currentUser.email : 'anonymous',
                summary: {
                    healthy: checkResults.filter(r => r.status === 'healthy').length,
                    broken: checkResults.filter(r => r.status === 'broken').length,
                    warning: checkResults.filter(r => r.status === 'warning').length,
                    redirects: checkResults.filter(r => r.redirectChain && r.redirectChain.length > 0).length
                },
                results: checkResults
            }, null, 2);

            downloadFile(jsonContent, `affiliate-links-report-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            showMessage('JSON report exported successfully!', 'success');
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function showMessage(message, type) {
            const existingMessages = document.querySelectorAll('.error-message, .success-message');
            existingMessages.forEach(msg => msg.remove());

            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;

            const inputSection = document.querySelector('.input-section');
            inputSection.appendChild(messageDiv);

            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);

            if (type === 'error') {
                trackEvent('link_check_error', { message: message });
            }
        }

        function handleEmailSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const email = form.email.value;
            
            document.getElementById('signupDate').value = new Date().toISOString();
            
            const submitBtn = form.querySelector('.btn-capture');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Processing...';
            submitBtn.disabled = true;
            
            fetch('/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams(new FormData(form)).toString()
            })
            .then(() => {
                showEmailSuccessMessage(email);
                form.reset();
                trackEvent('email_signup', { email: email });
            })
            .catch((error) => {
                console.error('Error:', error);
                showMessage('Something went wrong. Please try again!', 'error');
            })
            .finally(() => {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            });
        }

        function showEmailSuccessMessage(email) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.innerHTML = `
                <strong>🎉 Welcome to the VIP List!</strong><br>
                Please check your email (${email}) to confirm your subscription.<br>
                <strong>Note:</strong> You must click the verification link to complete your subscription and receive updates.
            `;
            
            const captureSection = document.querySelector('.email-capture-section');
            captureSection.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 10000);
        }

        // Legal Modal Functions
        function showLegalModal(type) {
            const modal = document.getElementById('legalModal');
            const title = document.getElementById('legalModalTitle');
            const content = document.getElementById('legalModalContent');
            
            const legalContent = {
                terms: `
                    <h4>Terms of Service</h4>
                    <p><strong>Last Updated:</strong> ${new Date().toLocaleDateString()}</p>
                    
                    <h5>1. Service Description</h5>
                    <p>Our affiliate link health checker provides automated validation of URLs for performance monitoring purposes. Results are provided "as-is" and may not reflect real-time status changes.</p>
                    
                    <h5>2. User Responsibilities</h5>
                    <p>Users must provide valid email addresses and are responsible for securing their account credentials. Custom link analysis requires account registration for data protection and service optimization.</p>
                    
                    <h5>3. Service Limitations</h5>
                    <p>We do not guarantee 100% accuracy of link validation results. Third-party website availability and response times may vary. SSL certificate validation reflects status at time of testing only.</p>
                    
                    <h5>4. Rate Limiting</h5>
                    <p>Free accounts are limited to 50 links per validation request. Commercial use may require upgraded service plans. Fair use policies apply to all automated requests.</p>
                    
                    <h5>5. Data Usage</h5>
                    <p>Link validation results may be stored temporarily for performance optimization. User-submitted URLs are processed securely and not shared with third parties without consent.</p>
                    
                    <h5>6. Limitation of Liability</h5>
                    <p>This service is provided for informational purposes only. We are not liable for business decisions made based on validation results or for any affiliate network policy violations.</p>
                `,
                privacy: `
                    <h4>Privacy Policy</h4>
                    <p><strong>Last Updated:</strong> ${new Date().toLocaleDateString()}</p>
                    
                    <h5>1. Information We Collect</h5>
                    <p><strong>Account Information:</strong> Email addresses for account creation and service notifications.<br>
                    <strong>Usage Data:</strong> Link validation requests, timestamps, and anonymized performance metrics.<br>
                    <strong>Technical Data:</strong> Browser information, IP addresses (anonymized), and session data for security purposes.</p>
                    
                    <h5>2. How We Use Your Information</h5>
                    <p>• Provide link validation services and result history<br>
                    • Send service updates and feature announcements<br>
                    • Improve service performance and reliability<br>
                    • Prevent abuse and ensure fair usage policies</p>
                    
                    <h5>3. Email Verification</h5>
                    <p>We implement double opt-in email verification to ensure data quality and comply with anti-spam regulations. Unverified email addresses are not added to marketing communications.</p>
                    
                    <h5>4. Data Sharing</h5>
                    <p>We do not sell, rent, or share personal information with third parties except as required by law or to protect our service integrity. Link validation requests are processed through secure, encrypted connections.</p>
                    
                    <h5>5. Your Rights</h5>
                    <p>You may request account deletion, data export, or communication preferences updates at any time. EU residents have additional rights under GDPR including data portability and erasure.</p>
                    
                    <h5>6. Security</h5>
                    <p>We implement industry-standard security measures including encrypted data transmission, secure session management, and regular security audits.</p>
                `,
                disclaimer: `
                    <h4>Service Disclaimer</h4>
                    <p><strong>Last Updated:</strong> ${new Date().toLocaleDateString()}</p>
                    
                    <h5>1. Accuracy Limitations</h5>
                    <p>Link validation results reflect website status at the time of testing. Real-time changes, geographic restrictions, or temporary outages may not be captured in validation results.</p>
                    
                    <h5>2. Affiliate Network Compliance</h5>
                    <p>This tool does not verify compliance with individual affiliate network terms of service. Users are responsible for ensuring their promotional methods comply with all applicable affiliate program requirements.</p>
                    
                    <h5>3. SSL Certificate Validation</h5>
                    <p>SSL certificate checks verify basic certificate validity and expiration status. Advanced security assessment requires specialized security audit tools beyond this service scope.</p>
                    
                    <h5>4. Performance Metrics</h5>
                    <p>Response time measurements may vary based on server location, network conditions, and temporary performance fluctuations. Results should be considered indicative rather than absolute performance measures.</p>
                    
                    <h5>5. Redirect Chain Analysis</h5>
                    <p>Redirect detection captures publicly accessible redirects. Some affiliate networks implement dynamic or conditional redirects that may not be detected through automated validation.</p>
                    
                    <h5>6. Business Use Disclaimer</h5>
                    <p>This tool is designed for informational purposes and basic affiliate link monitoring. Critical business decisions should incorporate additional validation methods and professional assessment.</p>
                    
                    <h5>7. Third-Party Liability</h5>
                    <p>We are not responsible for third-party website availability, policy changes, or affiliate network modifications that may affect link performance after validation.</p>
                `
            };
            
            title.textContent = type === 'terms' ? 'Terms of Service' : type === 'privacy' ? 'Privacy Policy' : 'Service Disclaimer';
            content.innerHTML = legalContent[type];
            modal.classList.add('active');
        }

        function closeLegalModal() {
            document.getElementById('legalModal').classList.remove('active');
        }

        function trackEvent(eventName, eventData) {
            console.log(`Analytics Event: ${eventName}`, eventData);
            
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    custom_parameter: eventData,
                    timestamp: new Date().toISOString()
                });
            }
            
            if (typeof analytics !== 'undefined') {
                analytics.track(eventName, {
                    ...eventData,
                    source: 'affiliate_link_checker',
                    version: '2.0.0'
                });
            }
        }

        function addTooltips() {
            const tooltips = {
                'followRedirects': 'Track redirect chains to identify affiliate link issues',
                'checkSSL': 'Verify SSL certificates are valid and secure',
                'checkSpeed': 'Measure page load performance and identify slow links',
                'timeout': 'Maximum time to wait for each link response',
                'userAgent': 'Browser identity sent with requests'
            };

            Object.keys(tooltips).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.title = tooltips[id];
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'Enter':
                        e.preventDefault();
                        if (!isChecking && (isAuthenticated || document.getElementById('links').value === demoLinks)) {
                            checkLinks();
                        }
                        break;
                    case 's':
                        e.preventDefault();
                        if (checkResults.length > 0) exportResults();
                        break;
                }
            }
        });

        // Auto-save results to localStorage for recovery
        function saveResults() {
            if (checkResults.length > 0 && isAuthenticated) {
                localStorage.setItem('linkChecker_lastResults', JSON.stringify({
                    timestamp: Date.now(),
                    results: checkResults,
                    user: currentUser.email
                }));
            }
        }

        function loadPreviousResults() {
            if (!isAuthenticated) return;
            
            const saved = localStorage.getItem('linkChecker_lastResults');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    const ageHours = (Date.now() - data.timestamp) / (1000 * 60 * 60);
                    
                    if (ageHours < 24 && data.results.length > 0 && data.user === currentUser.email) {
                        const restore = confirm(`Found previous scan results from ${new Date(data.timestamp).toLocaleString()}. Restore them?`);
                        if (restore) {
                            checkResults = data.results;
                            originalResults = [...checkResults];
                            document.getElementById('results').classList.remove('hidden');
                            updateStats();
                            displayResults();
                            showMessage('Previous results restored!', 'success');
                        }
                    }
                } catch (error) {
                    console.error('Error loading previous results:', error);
                }
            }
        }

        // Save results periodically
        setInterval(saveResults, 30000);
        window.addEventListener('beforeunload', saveResults);

        // Load previous results when user authenticates
        document.addEventListener('userAuthenticated', loadPreviousResults);
    </script>
</body>
</html>
